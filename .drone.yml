kind: pipeline
type: docker
name: default
steps:
    - name: build
      image: node:16
      pull: if-not-exists
      commands:
          - npm i -g pnpm
          - pnpm install
          - pnpm build
          - echo 打包成功...
    - name: docker
      image: plugins/docker
      pull: if-not-exists
      settings:
          repo: hurole/vue3-admin
          username:
              from_secret: docker_user
          password:
              from_secret: docker_pwd
          auto_tag: true
    - name: deploy
      image: docker:dind
      volumes:
          - name: dockersock
            path: /var/run/docker.sock
      commands:
          - docker run -d --name vue --restart -P 8080:8080 always hurole/vue3
          - docker ps -a
volumes:
    - name: dockersock
      host:
          path: /var/run/docker.sock
trigger:
    branch:
        include:
            - main
    event:
        include:
            - cron
            - custom
